import{d as F,h as T,a as U,u as V,b as z,r as c,s as n,j as e,L as d,G as A}from"./index-Dp2h_fCK.js";import{S as B}from"./SEO-mrLvCbYg.js";import{M}from"./MarkdownViewer-mICXRJH2.js";import{L as w}from"./lock-CQ2iX3HP.js";import{C as y}from"./chevron-left-Cu-ljGo3.js";import{U as $}from"./users-CnQ7qxKp.js";import{P as G}from"./pen-C51eTWt_.js";import{H as R}from"./history-BDJM9rcn.js";import{T as I}from"./trash-2-CZm5hRfL.js";import{P as J}from"./plus-CoMBZHWl.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=F("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),ne=()=>{const{slug:m}=T(),{user:o,isTeamMember:u}=U(),{language:l}=V(),h=z(),[s,p]=c.useState(null),[f,v]=c.useState(!1),[N,k]=c.useState(!1),[_,S]=c.useState(!0),[H,j]=c.useState(!1),[g,C]=c.useState([]),r={ko:{edit:"편집",history:"히스토리",share:"공유",delete:"삭제",newSubpage:"하위 페이지 만들기",lastUpdated:"최종 수정",by:"작성자",public:"공개",private:"비공개",backToWiki:"위키로 돌아가기",unauthorized:"이 페이지를 볼 권한이 없습니다.",notFound:"페이지를 찾을 수 없습니다.",confirmDelete:"정말로 이 페이지를 삭제하시겠습니까?",viewHistory:"변경 이력 보기",version:"버전",editedBy:"수정자",viewCount:"조회수"},en:{edit:"Edit",history:"History",share:"Share",delete:"Delete",newSubpage:"Create Subpage",lastUpdated:"Last updated",by:"by",public:"Public",private:"Private",backToWiki:"Back to Wiki",unauthorized:"You do not have permission to view this page.",notFound:"Page not found.",confirmDelete:"Are you sure you want to delete this page?",viewHistory:"View History",version:"Version",editedBy:"Edited by",viewCount:"Views"},ja:{edit:"編集",history:"履歴",share:"共有",delete:"削除",newSubpage:"サブページを作成",lastUpdated:"最終更新",by:"作成者",public:"公開",private:"非公開",backToWiki:"Wikiに戻る",unauthorized:"このページを表示する権限がありません。",notFound:"ページが見つかりません。",confirmDelete:"本当にこのページを削除しますか？",viewHistory:"変更履歴を表示",version:"バージョン",editedBy:"編集者",viewCount:"閲覧数"}}[l];c.useEffect(()=>{m&&q()},[m]);const q=async()=>{try{const{data:t,error:a}=await n.from("wiki_pages").select(`
          *,
          project:projects(name_ko, name_en, name_ja),
          parent:wiki_pages!parent_id(title, slug)
        `).eq("slug",m).single();if(a)throw a;if(t){p(t);const i=await P(t);if(k(i),i&&u){const x=await E(t);v(x)}i&&await L(t.id)}}catch(t){console.error("Error fetching page:",t),p(null)}finally{S(!1)}},P=async t=>{if(t.is_public)return!0;if(!u)return!1;if(t.project_id&&o){const{data:a}=await n.from("team_members").select("id").eq("user_id",o.id).eq("active",!0).single();if(!a)return!1;const{data:i}=await n.from("team_member_projects").select("id").eq("team_member_id",a.id).eq("project_id",t.project_id).single();return!!i}return!0},E=async t=>{if(!o)return!1;const{data:a}=await n.from("wiki_page_permissions").select("can_edit").eq("page_id",t.id).eq("user_id",o.id).single();if(a!=null&&a.can_edit)return!0;if(t.project_id){const{data:i}=await n.from("team_members").select("id").eq("user_id",o.id).eq("active",!0).single();if(!i)return!1;const{data:x}=await n.from("team_member_projects").select("id").eq("team_member_id",i.id).eq("project_id",t.project_id).single();return!!x}return!0},L=async t=>{console.log("Page viewed:",t)},W=async()=>{if(s)try{const{data:t,error:a}=await n.from("wiki_page_history").select("*").eq("page_id",s.id).order("created_at",{ascending:!1});if(a)throw a;C(t||[]),j(!0)}catch(t){console.error("Error fetching history:",t)}},D=async()=>{if(!(!s||!window.confirm(r.confirmDelete)))try{const{error:t}=await n.from("wiki_pages").delete().eq("id",s.id);if(t)throw t;h("/wiki")}catch(t){console.error("Error deleting page:",t)}},b=t=>new Date(t).toLocaleString(l==="ko"?"ko-KR":l==="ja"?"ja-JP":"en-US");return _?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):s?N?e.jsxs(e.Fragment,{children:[e.jsx(B,{title:s.title+" | Wiki | SayBerry Games"}),e.jsxs("div",{className:"min-h-screen py-20 px-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-6",children:[e.jsx(d,{to:"/wiki",className:"hover:text-white",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(y,{className:"h-4 w-4 rotate-180"}),s.parent&&e.jsxs(e.Fragment,{children:[e.jsx(d,{to:`/wiki/${s.parent.slug}`,className:"hover:text-white",children:s.parent.title}),e.jsx(y,{className:"h-4 w-4 rotate-180"})]}),e.jsx("span",{className:"text-white",children:s.title})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{className:"flex items-center gap-1",children:s.is_public?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4"}),r.public]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-4 w-4"}),r.private]})}),s.project&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4"}),s.project[`name_${l}`]||s.project.name_en]}),e.jsxs("span",{children:[r.lastUpdated," ",b(s.updated_at)]})]})]}),f&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(`/wiki/edit/${s.slug}`),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors",children:[e.jsx(G,{className:"h-4 w-4"}),r.edit]}),e.jsx("button",{onClick:W,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(R,{className:"h-5 w-5"})}),e.jsx("button",{onClick:D,className:"p-2 text-red-400 hover:text-red-300 transition-colors",children:e.jsx(I,{className:"h-5 w-5"})})]})]})}),e.jsx("div",{className:"prose prose-invert prose-lg max-w-none mb-12",children:e.jsx(M,{content:s.content})}),f&&e.jsx("div",{className:"border-t border-gray-800 pt-6",children:e.jsxs("button",{onClick:()=>h(`/wiki/new?parent=${s.id}`),className:"flex items-center gap-2 text-blue-400 hover:text-blue-300",children:[e.jsx(J,{className:"h-5 w-5"}),r.newSubpage]})})]}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsx("h2",{className:"text-2xl font-bold",children:r.viewHistory})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsx("div",{className:"space-y-4",children:g.map((t,a)=>e.jsxs("div",{className:"border-l-2 border-gray-700 pl-4",children:[e.jsxs("div",{className:"text-sm text-gray-400 mb-1",children:[r.version," ",g.length-a," • ",b(t.created_at)]}),e.jsx("div",{className:"font-medium",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-400",children:[r.editedBy,": ",t.edited_by]})]},t.id))})}),e.jsx("div",{className:"p-6 border-t border-gray-800",children:e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors",children:"닫기"})})]})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl mb-4",children:r.unauthorized}),e.jsx(d,{to:"/wiki",className:"text-blue-500 hover:text-blue-400",children:r.backToWiki})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl mb-4",children:r.notFound}),e.jsx(d,{to:"/wiki",className:"text-blue-500 hover:text-blue-400",children:r.backToWiki})]})})};export{ne as default};
