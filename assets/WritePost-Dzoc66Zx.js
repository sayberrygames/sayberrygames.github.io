import{a as I,b as R,u as U,g as $,r as d,s as N,j as e}from"./index-XUFKUiZG.js";import{S as M}from"./SEO-CKws_N_2.js";import{S as O,N as z}from"./NotionEditor-CvHJtxGL.js";import{M as B}from"./MarkdownViewer-CBji-6vd.js";import{I as W}from"./info-BPaS0kGe.js";import{E as G}from"./eye-Dpthu06j.js";const ee=()=>{var f,w;const{user:o,isAdmin:V,isTeamMember:k,userRole:h}=I(),g=R(),{language:m}=U(),[_]=$(),n=_.get("type")||"dev_notes",[i,S]=d.useState("ko"),[x,L]=d.useState(!1),[b,j]=d.useState(!1),[y,p]=d.useState(""),[C,P]=d.useState([]),[s,v]=d.useState({slug:"",title_ko:"",title_en:"",title_ja:"",excerpt_ko:"",excerpt_en:"",excerpt_ja:"",content_ko:"",content_en:"",content_ja:"",date:new Date().toISOString().split("T")[0],category:n==="news"?"Announcement":"Development",author:((f=o==null?void 0:o.user_metadata)==null?void 0:f.name)||((w=o==null?void 0:o.email)==null?void 0:w.split("@")[0])||"SayBerry Games",featured_image:"",steam_link:"",tags:[],published:!0,project_id:""}),E=t=>{const r=Date.now().toString(36);return t.toLowerCase().replace(/[가-힣]/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/--+/g,"-").trim()||`post-${r}`},T={ko:{title:n==="news"?"뉴스 작성":"개발 노트 작성",slug:"URL 주소 (자동 생성됨)",slugTooltip:"제목을 입력하면 자동으로 생성됩니다",titleLabel:"제목",excerptLabel:"요약 (선택사항)",contentLabel:"내용",date:"날짜",category:"카테고리",author:"작성자",featuredImage:"대표 이미지 URL (선택사항)",steamLink:"Steam 링크 (선택사항)",tags:"태그 (쉼표로 구분)",published:"공개",project:"프로젝트",selectProject:"프로젝트를 선택하세요",submit:"저장",cancel:"취소",preview:"미리보기",edit:"편집",error:"저장에 실패했습니다.",unauthorized:"권한이 없습니다.",requiredFields:"필수 입력 항목을 모두 작성해주세요."},en:{title:n==="news"?"Write News":"Write Development Note",slug:"URL Address (auto-generated)",slugTooltip:"Automatically generated from title",titleLabel:"Title",excerptLabel:"Excerpt (Optional)",contentLabel:"Content",date:"Date",category:"Category",author:"Author",featuredImage:"Featured Image URL (Optional)",steamLink:"Steam Link (Optional)",tags:"Tags (comma separated)",published:"Published",project:"Project",selectProject:"Select a project",submit:"Save",cancel:"Cancel",preview:"Preview",edit:"Edit",error:"Failed to save.",unauthorized:"Unauthorized.",requiredFields:"Please fill in all required fields."},ja:{title:n==="news"?"ニュース作成":"開発ノート作成",slug:"URLアドレス（自動生成）",slugTooltip:"タイトルから自動的に生成されます",titleLabel:"タイトル",excerptLabel:"要約（オプション）",contentLabel:"内容",date:"日付",category:"カテゴリー",author:"著者",featuredImage:"アイキャッチ画像URL（オプション）",steamLink:"Steamリンク（オプション）",tags:"タグ（カンマ区切り）",published:"公開",project:"プロジェクト",selectProject:"プロジェクトを選択してください",submit:"保存",cancel:"キャンセル",preview:"プレビュー",edit:"編集",error:"保存に失敗しました。",unauthorized:"権限がありません。",requiredFields:"必須項目をすべて入力してください。"}};d.useEffect(()=>{F()},[]);const F=async()=>{try{const{data:t,error:r}=await N.from("projects").select("*").eq("active",!0).order("sort_order");if(r)throw r;P(t||[])}catch(t){console.error("Error fetching projects:",t)}},a=T[m];if(!(o?n==="dev_notes"?k:n==="news"?h==="admin"||h==="lead":!1:!1))return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 text-xl mb-4",children:a.unauthorized}),!o&&e.jsx("button",{onClick:()=>g("/login"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-white",children:"로그인"})]})});const q=async t=>{if(t.preventDefault(),!s.slug||!s.title_ko||!s.title_en||!s.title_ja||!s.content_ko||!s.content_en||!s.content_ja){p(a.requiredFields);return}j(!0),p("");try{const r=s.tags.length>0?s.tags.join(",").split(",").map(D=>D.trim()).filter(Boolean):[],c={...s,tags:r,created_by:o.id},{error:u}=await N.from(n).insert([c]);if(u)throw u;g(n==="news"?"/news":"/devnotes")}catch(r){console.error("Error saving post:",r),p(a.error)}finally{j(!1)}},l=(t,r)=>{if(v(c=>({...c,[t]:r})),t==="title_ko"&&r){const c=E(r);v(u=>({...u,slug:c}))}},A=n==="news"?["Announcement","Update","Event","Release","Partnership"]:["Development","Update","Feature","Announcement","Milestone","Technical"];return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:a.title+" | SayBerry Games"}),e.jsx("div",{className:"min-h-screen py-20 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:a.title}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"기본 정보"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[a.slug," *",e.jsxs("div",{className:"group relative",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 bottom-full mb-2 hidden group-hover:block bg-gray-700 text-xs text-white p-2 rounded whitespace-nowrap",children:a.slugTooltip})]})]}),e.jsx("input",{type:"text",value:s.slug,readOnly:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-400 cursor-not-allowed",placeholder:"제목을 먼저 입력하세요"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.date," *"]}),e.jsx("input",{type:"date",value:s.date,onChange:t=>l("date",t.target.value),required:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.category," *"]}),e.jsx("select",{value:s.category,onChange:t=>l("category",t.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white",children:A.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.author," *"]}),e.jsx("input",{type:"text",value:s.author,onChange:t=>l("author",t.target.value),required:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a.tags}),e.jsx("input",{type:"text",value:s.tags.join(", "),onChange:t=>l("tags",t.target.value.split(",").map(r=>r.trim())),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white",placeholder:"tag1, tag2, tag3"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a.featuredImage}),e.jsx("input",{type:"url",value:s.featured_image,onChange:t=>l("featured_image",t.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a.steamLink}),e.jsx("input",{type:"url",value:s.steam_link,onChange:t=>l("steam_link",t.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]})]}),n==="dev_notes"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.project," *"]}),e.jsxs("select",{value:s.project_id,onChange:t=>l("project_id",t.target.value),required:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white",children:[e.jsx("option",{value:"",children:a.selectProject}),C.map(t=>e.jsx("option",{value:t.id,children:m==="ko"?t.name_ko:m==="ja"?t.name_ja:t.name_en},t.id))]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.published,onChange:t=>l("published",t.target.checked),className:"mr-2",id:"published"}),e.jsx("label",{htmlFor:"published",children:a.published})]})]}),e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg",children:[e.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-gray-700",children:[["ko","en","ja"].map(t=>e.jsx("button",{type:"button",onClick:()=>S(t),className:`pb-2 px-4 ${i===t?"border-b-2 border-blue-500 text-blue-500":"text-gray-400 hover:text-white"}`,children:t==="ko"?"한국어":t==="en"?"English":"日本語"},t)),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",onClick:()=>L(!x),className:"flex items-center space-x-2 text-gray-400 hover:text-white",children:x?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:a.edit})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:a.preview})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.titleLabel," *"]}),e.jsx("input",{type:"text",value:s[`title_${i}`],onChange:t=>l(`title_${i}`,t.target.value),required:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:a.excerptLabel}),e.jsx("textarea",{value:s[`excerpt_${i}`],onChange:t=>l(`excerpt_${i}`,t.target.value),rows:3,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[a.contentLabel," *"]}),x?e.jsx("div",{className:"bg-gray-800 p-4 rounded-lg min-h-[500px]",children:e.jsx(B,{content:s[`content_${i}`]})}):e.jsx(z,{content:s[`content_${i}`],onChange:t=>l(`content_${i}`,t),placeholder:m==="ko"?"내용을 입력하세요... (/ 를 누르면 메뉴가 나타납니다)":"Type your content... (Press / for menu)",height:500})]})]}),y&&e.jsx("div",{className:"text-red-500 bg-red-900/20 p-4 rounded-lg",children:y}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-md text-white font-medium disabled:opacity-50",children:b?"...":a.submit}),e.jsx("button",{type:"button",onClick:()=>g(-1),className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-md text-white font-medium",children:a.cancel})]})]})]})})]})};export{ee as default};
