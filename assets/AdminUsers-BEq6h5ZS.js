import{a as P,u as z,b as M,r as n,s as S,j as e,S as i,M as R,X as F}from"./index-kXRut6Zz.js";import{S as L}from"./SEO-BkDd-6DZ.js";import{U as B}from"./users-EtqIMBIj.js";import{A as J}from"./alert-circle-BYj_chZ3.js";import{C as O}from"./calendar-B8Z56Dcj.js";import{C as q}from"./check-CghdE1Ih.js";import{P as G}from"./pen-BdHQ6UuH.js";const I=()=>{const{user:o,isAdmin:x}=P(),{language:u}=z(),E=M(),[d,h]=n.useState([]),[U,C]=n.useState(!0),[p,j]=n.useState(null),[g,f]=n.useState(""),[N,b]=n.useState(""),[v,y]=n.useState(""),[w,m]=n.useState(""),t={ko:{title:"회원 관리",email:"이메일",name:"이름",role:"권한",memberSince:"가입일",edit:"수정",save:"저장",cancel:"취소",updateSuccess:"성공적으로 업데이트되었습니다.",updateError:"업데이트 중 오류가 발생했습니다.",unauthorized:"관리자 권한이 필요합니다.",totalUsers:"전체 회원",roles:{admin:"관리자",lead:"팀장",member:"팀원",user:"일반 사용자"}},en:{title:"User Management",email:"Email",name:"Name",role:"Role",memberSince:"Member Since",edit:"Edit",save:"Save",cancel:"Cancel",updateSuccess:"Successfully updated.",updateError:"Error updating.",unauthorized:"Admin access required.",totalUsers:"Total Users",roles:{admin:"Administrator",lead:"Team Lead",member:"Team Member",user:"User"}},ja:{title:"ユーザー管理",email:"メール",name:"名前",role:"権限",memberSince:"登録日",edit:"編集",save:"保存",cancel:"キャンセル",updateSuccess:"正常に更新されました。",updateError:"更新中にエラーが発生しました。",unauthorized:"管理者権限が必要です。",totalUsers:"総ユーザー数",roles:{admin:"管理者",lead:"チームリーダー",member:"チームメンバー",user:"ユーザー"}}}[u];n.useEffect(()=>{if(!x){E("/");return}_()},[x]);const _=async()=>{try{const{data:{session:s}}=await S.auth.getSession();if(!s)throw new Error("No session");let a=await fetch("https://hapjsigxjmogajicrtjd.supabase.co/functions/v1/admin-users",{headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error("Admin users function not available. Please ensure the Edge Function is deployed.");if(!a.ok){const r=await a.text();throw console.error("API Error:",r),new Error(`Failed to fetch users: ${a.status}`)}const l=await a.json();h(l.users||[]),m("")}catch(s){console.error("Error fetching users:",s),m("Failed to fetch users. Please check configuration."),o&&h([{id:o.id,email:o.email||"",created_at:o.created_at,user_metadata:o.user_metadata||{role:"user"}}])}finally{C(!1)}},k=s=>{const a=d.find(l=>l.id===s);a&&(j(s),f(a.user_metadata.role||"user"),b(a.user_metadata.name||""))},A=async s=>{m(""),y("");try{const{data:{session:a}}=await S.auth.getSession();if(!a)throw new Error("No session");let l=await fetch(`https://hapjsigxjmogajicrtjd.supabase.co/functions/v1/admin-users/${s}`,{method:"PUT",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({user_metadata:{role:g,name:N}})});if(!l.ok){const r=await l.text();throw console.error("Update error:",r),new Error(`Failed to update user: ${l.status}`)}h(d.map(r=>r.id===s?{...r,user_metadata:{...r.user_metadata,role:g,name:N}}:r)),j(null),y(t.updateSuccess),setTimeout(()=>y(""),3e3)}catch(a){console.error("Error updating user:",a),m(t.updateError)}},$=()=>{j(null),f(""),b("")},T=s=>new Date(s).toLocaleDateString(u==="ko"?"ko-KR":u==="ja"?"ja-JP":"en-US",{year:"numeric",month:"long",day:"numeric"}),c=s=>{switch(s){case"admin":return"text-red-400";case"lead":return"text-yellow-400";case"member":return"text-blue-400";default:return"text-gray-400"}};return U?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):x?e.jsxs(e.Fragment,{children:[e.jsx(L,{title:t.title+" | SayBerry Games"}),e.jsx("div",{className:"min-h-screen py-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold flex items-center gap-3",children:[e.jsx(B,{className:"h-10 w-10"}),t.title]}),e.jsxs("p",{className:"text-gray-400 mt-2",children:[t.totalUsers,": ",d.length]})]})}),v&&e.jsx("div",{className:"mb-6 p-4 bg-green-900/20 border border-green-500 rounded-lg text-green-400",children:v}),w&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500 rounded-lg text-red-400 flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),w]}),e.jsx("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-left",children:[e.jsxs("th",{className:"px-6 py-4 text-sm font-medium text-gray-300",children:[e.jsx(R,{className:"inline h-4 w-4 mr-2"}),t.email]}),e.jsx("th",{className:"px-6 py-4 text-sm font-medium text-gray-300",children:t.name}),e.jsxs("th",{className:"px-6 py-4 text-sm font-medium text-gray-300",children:[e.jsx(i,{className:"inline h-4 w-4 mr-2"}),t.role]}),e.jsxs("th",{className:"px-6 py-4 text-sm font-medium text-gray-300",children:[e.jsx(O,{className:"inline h-4 w-4 mr-2"}),t.memberSince]}),e.jsx("th",{className:"px-6 py-4 text-sm font-medium text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm",children:p===s.id?e.jsx("input",{type:"text",value:N,onChange:a=>b(a.target.value),className:"px-2 py-1 bg-gray-800 border border-gray-600 rounded-md focus:border-blue-500 focus:outline-none"}):s.user_metadata.name||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:p===s.id?e.jsxs("select",{value:g,onChange:a=>f(a.target.value),className:"px-2 py-1 bg-gray-800 border border-gray-600 rounded-md focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"user",children:t.roles.user}),e.jsx("option",{value:"member",children:t.roles.member}),e.jsx("option",{value:"lead",children:t.roles.lead}),e.jsx("option",{value:"admin",children:t.roles.admin})]}):e.jsx("span",{className:`font-medium ${c(s.user_metadata.role||"user")}`,children:t.roles[s.user_metadata.role]||t.roles.user})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:T(s.created_at)}),e.jsx("td",{className:"px-6 py-4 text-sm",children:p===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(s.id),className:"p-1 text-green-400 hover:text-green-300",title:t.save,children:e.jsx(q,{className:"h-5 w-5"})}),e.jsx("button",{onClick:$,className:"p-1 text-red-400 hover:text-red-300",title:t.cancel,children:e.jsx(F,{className:"h-5 w-5"})})]}):e.jsx("button",{onClick:()=>k(s.id),className:"p-1 text-blue-400 hover:text-blue-300",title:t.edit,children:e.jsx(G,{className:"h-5 w-5"})})})]},s.id))})]})})}),e.jsxs("div",{className:"mt-8 bg-gray-900 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"권한 설명"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:`h-5 w-5 mt-0.5 ${c("admin")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.roles.admin}),e.jsx("p",{className:"text-gray-400",children:"모든 권한. 회원 관리, 모든 게시물 작성/수정/삭제 가능"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:`h-5 w-5 mt-0.5 ${c("lead")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.roles.lead}),e.jsx("p",{className:"text-gray-400",children:"팀장급. 뉴스 작성 가능, 모든 개발노트 수정 가능"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:`h-5 w-5 mt-0.5 ${c("member")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.roles.member}),e.jsx("p",{className:"text-gray-400",children:"팀원. 개발노트 작성 가능, 본인 글만 수정 가능"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:`h-5 w-5 mt-0.5 ${c("user")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.roles.user}),e.jsx("p",{className:"text-gray-400",children:"일반 사용자. 콘텐츠 열람만 가능"})]})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl",children:t.unauthorized})]})})};export{I as default};
