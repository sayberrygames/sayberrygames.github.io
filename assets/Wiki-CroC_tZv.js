import{d as u,a as F,u as W,b as A,r as l,s as h,j as e,B as P,L as g,U as V}from"./index-UNarOc67.js";import{S as B}from"./SEO-hFNSaJYv.js";import{L as k}from"./lock-ChGaFDfd.js";import{P as _}from"./plus-_OWJ0BEM.js";import{H as I}from"./history-QHX_c26K.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=u("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=u("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=u("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=u("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),te=()=>{const{user:y,isTeamMember:x,isAdmin:f}=F(),{language:o}=W(),p=A(),[b,S]=l.useState([]),[M,$]=l.useState([]),[d,w]=l.useState(null),[q,j]=l.useState([]),[m,E]=l.useState(""),[L,D]=l.useState(!0),c={ko:{title:"팀 위키",subtitle:"팀 내부 문서 및 지식 공유",createPage:"새 페이지",search:"검색...",allProjects:"전체 프로젝트",recentPages:"최근 페이지",myPages:"내 페이지",projectDocs:"프로젝트 문서",unauthorized:"팀원만 접근 가능합니다.",noPages:"아직 위키 페이지가 없습니다.",public:"공개",private:"비공개",lastUpdated:"최종 수정",by:"작성자",newPage:"새 페이지 만들기",projects:"프로젝트",settings:"설정"},en:{title:"Team Wiki",subtitle:"Internal documentation and knowledge sharing",createPage:"New Page",search:"Search...",allProjects:"All Projects",recentPages:"Recent Pages",myPages:"My Pages",projectDocs:"Project Docs",unauthorized:"Team members only.",noPages:"No wiki pages yet.",public:"Public",private:"Private",lastUpdated:"Last updated",by:"by",newPage:"Create New Page",projects:"Projects",settings:"Settings"},ja:{title:"チームWiki",subtitle:"チーム内部ドキュメントと知識共有",createPage:"新規ページ",search:"検索...",allProjects:"すべてのプロジェクト",recentPages:"最近のページ",myPages:"マイページ",projectDocs:"プロジェクト文書",unauthorized:"チームメンバーのみアクセス可能です。",noPages:"Wikiページがまだありません。",public:"公開",private:"非公開",lastUpdated:"最終更新",by:"作成者",newPage:"新しいページを作成",projects:"プロジェクト",settings:"設定"}}[o];l.useEffect(()=>{if(!x){p("/");return}U(),z(),N()},[x]),l.useEffect(()=>{N()},[d,m]);const U=async()=>{if(y)try{const{data:t,error:r}=await h.from("team_members").select("id").eq("user_id",y.id).eq("active",!0).single();if(r||!t){console.log("No team member record found for user"),j([]);return}const{data:s,error:a}=await h.from("team_member_projects").select("project_id").eq("team_member_id",t.id);if(a)throw a;const n=(s==null?void 0:s.map(i=>i.project_id))||[];j(n)}catch(t){console.error("Error fetching user projects:",t),j([])}},z=async()=>{try{const{data:t,error:r}=await h.from("projects").select("*").eq("active",!0).order("sort_order");if(r)throw r;$(t||[])}catch(t){console.error("Error fetching projects:",t)}},N=async()=>{try{let t=h.from("wiki_pages").select("*").order("updated_at",{ascending:!1});d&&(t=t.eq("project_id",d)),m&&(t=t.or(`title.ilike.%${m}%,content.ilike.%${m}%`));const{data:r,error:s}=await t;if(s)throw s;const a=C(r||[]);S(a)}catch(t){console.error("Error fetching pages:",t)}finally{D(!1)}},C=t=>{const r=new Map,s=[];return t.forEach(a=>{r.set(a.id,{...a,children:[]})}),t.forEach(a=>{const n=r.get(a.id);if(a.parent_id&&r.has(a.parent_id)){const i=r.get(a.parent_id);i.children=i.children||[],i.children.push(n)}else s.push(n)}),s},H=t=>t[`name_${o}`]||t.name_en,T=t=>{const r=new Date(t),a=new Date().getTime()-r.getTime(),n=Math.floor(a/(1e3*60*60));if(n<1){const i=Math.floor(a/6e4);return o==="ko"?`${i}분 전`:o==="ja"?`${i}分前`:`${i} minutes ago`}else return n<24?o==="ko"?`${n}시간 전`:o==="ja"?`${n}時間前`:`${n} hours ago`:r.toLocaleDateString(o==="ko"?"ko-KR":o==="ja"?"ja-JP":"en-US")},v=(t,r=0)=>t.map(s=>e.jsxs("div",{style:{marginLeft:`${r*20}px`},children:[e.jsxs(g,{to:`/wiki/${s.slug}`,className:"flex items-center gap-2 p-3 hover:bg-gray-800 rounded-lg transition-colors group",children:[s.children&&s.children.length>0?e.jsx(O,{className:"h-5 w-5 text-gray-400"}):e.jsx(R,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"flex-1",children:s.title}),!s.is_public&&e.jsx(k,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500 opacity-0 group-hover:opacity-100",children:T(s.updated_at)})]}),s.children&&s.children.length>0&&e.jsx("div",{className:"ml-2",children:v(s.children,r+1)})]},s.id));return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):x?e.jsxs(e.Fragment,{children:[e.jsx(B,{title:c.title+" | SayBerry Games"}),e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"w-64 bg-gray-900 border-r border-gray-800 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"h-6 w-6"}),c.title]}),e.jsx("p",{className:"text-sm text-gray-400",children:c.subtitle})]}),e.jsxs("button",{onClick:()=>p("/wiki/new"),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors mb-6",children:[e.jsx(_,{className:"h-5 w-5"}),c.createPage]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:c.projects}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("button",{onClick:()=>w(null),className:`w-full text-left px-3 py-2 rounded-md transition-colors ${d===null?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:c.allProjects}),M.filter(t=>f||q.includes(t.id)).map(t=>e.jsxs("button",{onClick:()=>w(t.id),className:`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center gap-2 ${d===t.id?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[t.logo_url&&e.jsx("img",{src:t.logo_url,alt:"",className:"w-4 h-4"}),H(t)]},t.id))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(g,{to:"/wiki/recent",className:"flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-md transition-colors",children:[e.jsx(I,{className:"h-5 w-5"}),c.recentPages]}),e.jsxs(g,{to:"/wiki/my",className:"flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-md transition-colors",children:[e.jsx(V,{className:"h-5 w-5"}),c.myPages]}),f&&e.jsxs(g,{to:"/wiki/settings",className:"flex items-center gap-2 px-3 py-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-md transition-colors",children:[e.jsx(Z,{className:"h-5 w-5"}),c.settings]})]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-2xl",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:c.search,value:m,onChange:t=>E(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:border-blue-500 focus:outline-none"})]})}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-6",children:b.length>0?e.jsx("div",{className:"space-y-1",children:v(b)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"h-16 w-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 mb-4",children:c.noPages}),e.jsxs("button",{onClick:()=>p("/wiki/new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:[e.jsx(_,{className:"h-5 w-5"}),c.newPage]})]})})]})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl",children:c.unauthorized})]})})};export{te as default};
