import{d as $,h as B,g as H,a as X,u as J,b as K,r as a,s as g,j as e,G as Q,X as Y}from"./index-CaI0NtCl.js";import{S as Z}from"./SEO-CF4K7_er.js";import{S as ee,N as se}from"./NotionEditor-B2WN3SQl.js";import{M as te}from"./MarkdownViewer-B3KsmAeN.js";import{L as C}from"./lock-DepqWQXJ.js";import{I as re}from"./info-DGbG8y-S.js";import{E as ae}from"./eye-DddH8_73.js";import{A as ie}from"./alert-circle-CweX66z3.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=$("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),be=()=>{const{slug:c}=B(),[L]=H(),T=L.get("parent"),{user:i,isTeamMember:p}=X(),{language:d}=J(),x=K(),l=!!c,[u,v]=a.useState(""),[n,y]=a.useState(""),[h,w]=a.useState(""),[b,N]=a.useState(null),[m,j]=a.useState(!1),[q,U]=a.useState([]),[ne,z]=a.useState([]),[I,P]=a.useState(!1),[S,k]=a.useState(!1),[E,o]=a.useState(""),[f,F]=a.useState(!1),[_,M]=a.useState(null),t={ko:{newPage:"새 위키 페이지",editPage:"위키 페이지 편집",title:"제목",slug:"URL 주소 (자동 생성됨)",slugTooltip:"제목을 입력하면 자동으로 생성됩니다",content:"내용",project:"프로젝트",selectProject:"프로젝트 선택 (선택사항)",visibility:"공개 설정",public:"공개 (누구나 볼 수 있음)",private:"비공개 (팀원만 볼 수 있음)",save:"저장",cancel:"취소",preview:"미리보기",edit:"편집",requiredFields:"제목과 내용은 필수입니다.",slugExists:"이미 사용 중인 URL입니다.",unauthorized:"권한이 없습니다.",savingError:"저장 중 오류가 발생했습니다."},en:{newPage:"New Wiki Page",editPage:"Edit Wiki Page",title:"Title",slug:"URL Address (auto-generated)",slugTooltip:"Automatically generated from title",content:"Content",project:"Project",selectProject:"Select Project (Optional)",visibility:"Visibility",public:"Public (Anyone can view)",private:"Private (Team members only)",save:"Save",cancel:"Cancel",preview:"Preview",edit:"Edit",requiredFields:"Title and content are required.",slugExists:"This URL is already in use.",unauthorized:"Unauthorized.",savingError:"Error saving page."},ja:{newPage:"新しいWikiページ",editPage:"Wikiページを編集",title:"タイトル",slug:"URLアドレス（自動生成）",slugTooltip:"タイトルから自動的に生成されます",content:"内容",project:"プロジェクト",selectProject:"プロジェクトを選択（オプション）",visibility:"公開設定",public:"公開（誰でも閲覧可能）",private:"非公開（チームメンバーのみ）",save:"保存",cancel:"キャンセル",preview:"プレビュー",edit:"編集",requiredFields:"タイトルと内容は必須です。",slugExists:"このURLは既に使用されています。",unauthorized:"権限がありません。",savingError:"ページの保存中にエラーが発生しました。"}}[d];a.useEffect(()=>{if(!p){x("/wiki");return}R(),A(),l&&c&&W()},[p,c]);const R=async()=>{i&&z([])},A=async()=>{try{const{data:s,error:r}=await g.from("projects").select("*").eq("active",!0).order("sort_order");if(r)throw r;U(s||[])}catch(s){console.error("Error fetching projects:",s)}},W=async()=>{P(!0);try{const{data:s,error:r}=await g.from("wiki_pages").select("*").eq("slug",c).single();if(r)throw r;s&&(M(s),v(s.title),y(s.content),w(s.slug),N(s.project_id),j(s.is_public))}catch(s){console.error("Error fetching page:",s),o(t.unauthorized)}finally{P(!1)}},O=s=>s.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/--+/g,"-").trim(),V=s=>{v(s),l||w(O(s))},G=async s=>{if(s.preventDefault(),!u||!n){o(t.requiredFields);return}k(!0),o("");try{if(l&&_){const{error:r}=await g.from("wiki_pages").update({title:u,content:n,project_id:b,is_public:m,last_edited_by:i==null?void 0:i.id,updated_at:new Date().toISOString()}).eq("id",_.id);if(r)throw r}else{const{error:r}=await g.from("wiki_pages").insert({title:u,slug:h,content:n,parent_id:T,project_id:b,is_public:m,author_id:i==null?void 0:i.id,last_edited_by:i==null?void 0:i.id});if(r){if(r.code==="23505"){o(t.slugExists);return}throw r}}x(`/wiki/${h}`)}catch(r){console.error("Error saving page:",r),o(t.savingError)}finally{k(!1)}},D=s=>s[`name_${d}`]||s.name_en;return I?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):p?e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:(l?t.editPage:t.newPage)+" | Wiki | SayBerry Games"}),e.jsx("div",{className:"min-h-screen py-20 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:l?t.editPage:t.newPage}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[t.title," *"]}),e.jsx("input",{type:"text",value:u,onChange:s=>V(s.target.value),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md focus:border-blue-500 focus:outline-none",required:!0})]}),!l&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[t.slug," *",e.jsxs("div",{className:"group relative",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 bottom-full mb-2 hidden group-hover:block bg-gray-700 text-xs text-white p-2 rounded whitespace-nowrap",children:t.slugTooltip})]})]}),e.jsx("input",{type:"text",value:h,readOnly:!0,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-400 cursor-not-allowed",placeholder:"제목을 먼저 입력하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:t.project}),e.jsxs("select",{value:b||"",onChange:s=>N(s.target.value||null),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:t.selectProject}),q.map(s=>e.jsx("option",{value:s.id,children:D(s)},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:t.visibility}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!m,onChange:()=>j(!1),className:"text-blue-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:t.private})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:m,onChange:()=>j(!0),className:"text-blue-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:t.public})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:[t.content," *"]}),e.jsx("button",{type:"button",onClick:()=>F(!f),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),t.edit]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4"}),t.preview]})})]}),f?e.jsx("div",{className:"bg-gray-800 rounded-lg p-6 min-h-[400px] prose prose-invert max-w-none",children:e.jsx(te,{content:n})}):e.jsx(se,{content:n,onChange:y,placeholder:d==="ko"?"내용을 입력하세요... (/ 를 누르면 메뉴가 나타납니다)":d==="ja"?"コンテンツを入力... (/でメニュー表示)":"Type your content... (Press / for menu)",height:400})]}),E&&e.jsxs("div",{className:"p-4 bg-red-900/20 border border-red-500 rounded-lg text-red-400 flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),E]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"submit",disabled:S,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 rounded-md transition-colors",children:[e.jsx(le,{className:"h-5 w-5"}),S?"...":t.save]}),e.jsxs("button",{type:"button",onClick:()=>x("/wiki"),className:"flex items-center gap-2 px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors",children:[e.jsx(Y,{className:"h-5 w-5"}),t.cancel]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl",children:t.unauthorized})]})})};export{be as default};
