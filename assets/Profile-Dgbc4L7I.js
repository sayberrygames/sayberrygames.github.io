import{a as A,u as I,b as K,r as a,s as c,j as e,M as B,S as G}from"./index-BDTgJ52l.js";import{S as J}from"./SEO-raaPMi4M.js";import{A as W}from"./alert-circle-Bd3-sQRw.js";import{C as $}from"./calendar-DtRGVq-d.js";import{K as q}from"./key-CJqA4_rB.js";const ee=()=>{const{user:m,signOut:E}=A(),{language:u}=I(),b=K(),[n,L]=a.useState(null),[M,U]=a.useState(!0),[h,d]=a.useState(!1),[f,l]=a.useState(""),[y,t]=a.useState(""),[O,p]=a.useState(!1),[z,P]=a.useState(""),[i,w]=a.useState(""),[N,x]=a.useState(""),[j,S]=a.useState(""),s={ko:{title:"내 프로필",email:"이메일",role:"권한",memberSince:"가입일",displayName:"표시 이름",changePassword:"비밀번호 변경",currentPassword:"현재 비밀번호",newPassword:"새 비밀번호",confirmPassword:"새 비밀번호 확인",updatePassword:"비밀번호 업데이트",updateProfile:"프로필 업데이트",signOut:"로그아웃",cancel:"취소",passwordMismatch:"새 비밀번호가 일치하지 않습니다.",passwordTooShort:"비밀번호는 최소 6자 이상이어야 합니다.",updateSuccess:"성공적으로 업데이트되었습니다.",updateError:"업데이트 중 오류가 발생했습니다.",resetPassword:"비밀번호를 잊으셨나요?",resetPasswordInfo:"이메일로 비밀번호 재설정 링크를 보내드립니다.",sendResetLink:"재설정 링크 보내기",resetLinkSent:"비밀번호 재설정 링크가 이메일로 전송되었습니다.",roles:{admin:"관리자",lead:"팀장",member:"팀원",user:"일반 사용자"}},en:{title:"My Profile",email:"Email",role:"Role",memberSince:"Member Since",displayName:"Display Name",changePassword:"Change Password",currentPassword:"Current Password",newPassword:"New Password",confirmPassword:"Confirm New Password",updatePassword:"Update Password",updateProfile:"Update Profile",signOut:"Sign Out",cancel:"Cancel",passwordMismatch:"New passwords do not match.",passwordTooShort:"Password must be at least 6 characters.",updateSuccess:"Successfully updated.",updateError:"Error updating.",resetPassword:"Forgot Password?",resetPasswordInfo:"We'll send you a password reset link via email.",sendResetLink:"Send Reset Link",resetLinkSent:"Password reset link has been sent to your email.",roles:{admin:"Administrator",lead:"Team Lead",member:"Team Member",user:"User"}},ja:{title:"マイプロフィール",email:"メール",role:"権限",memberSince:"登録日",displayName:"表示名",changePassword:"パスワード変更",currentPassword:"現在のパスワード",newPassword:"新しいパスワード",confirmPassword:"新しいパスワード（確認）",updatePassword:"パスワードを更新",updateProfile:"プロフィールを更新",signOut:"ログアウト",cancel:"キャンセル",passwordMismatch:"新しいパスワードが一致しません。",passwordTooShort:"パスワードは6文字以上である必要があります。",updateSuccess:"正常に更新されました。",updateError:"更新中にエラーが発生しました。",resetPassword:"パスワードを忘れましたか？",resetPasswordInfo:"パスワードリセットリンクをメールで送信します。",sendResetLink:"リセットリンクを送信",resetLinkSent:"パスワードリセットリンクがメールで送信されました。",roles:{admin:"管理者",lead:"チームリーダー",member:"チームメンバー",user:"ユーザー"}}}[u];a.useEffect(()=>{if(!m){b("/login");return}v()},[m]);const v=async()=>{var r,g,k;try{const{data:o}=await c.auth.getUser();if(!o.user)throw new Error("No user found");const C={id:o.user.id,email:o.user.email||"",role:((r=o.user.user_metadata)==null?void 0:r.role)||"user",name:((g=o.user.user_metadata)==null?void 0:g.name)||((k=o.user.email)==null?void 0:k.split("@")[0]),created_at:o.user.created_at};L(C),S(C.name||"")}catch(o){console.error("Error fetching profile:",o),t(s.updateError)}finally{U(!1)}},R=async()=>{if(m){d(!0),t(""),l("");try{const{error:r}=await c.auth.updateUser({data:{name:j}});if(r)throw r;l(s.updateSuccess),await v()}catch(r){console.error("Error updating profile:",r),t(s.updateError)}finally{d(!1)}}},T=async()=>{if(t(""),l(""),i!==N){t(s.passwordMismatch);return}if(i.length<6){t(s.passwordTooShort);return}d(!0);try{const{error:r}=await c.auth.updateUser({password:i});if(r)throw r;l(s.updateSuccess),p(!1),P(""),w(""),x("")}catch(r){console.error("Error changing password:",r),t(s.updateError)}finally{d(!1)}},F=async()=>{if(n!=null&&n.email){d(!0),t(""),l("");try{const{error:r}=await c.auth.resetPasswordForEmail(n.email,{redirectTo:`${window.location.origin}/reset-password`});if(r)throw r;l(s.resetLinkSent)}catch(r){console.error("Error sending reset link:",r),t(s.updateError)}finally{d(!1)}}},D=async()=>{await E(),b("/")},_=r=>new Date(r).toLocaleDateString(u==="ko"?"ko-KR":u==="ja"?"ja-JP":"en-US",{year:"numeric",month:"long",day:"numeric"});return M?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):n?e.jsxs(e.Fragment,{children:[e.jsx(J,{title:s.title+" | SayBerry Games"}),e.jsx("div",{className:"min-h-screen py-20 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:s.title}),f&&e.jsx("div",{className:"mb-6 p-4 bg-green-900/20 border border-green-500 rounded-lg text-green-400",children:f}),y&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500 rounded-lg text-red-400 flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),y]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"기본 정보"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:s.email}),e.jsx("p",{className:"font-medium",children:n.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:s.role}),e.jsx("p",{className:"font-medium",children:s.roles[n.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:s.memberSince}),e.jsx("p",{className:"font-medium",children:_(n.created_at)})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"프로필 설정"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium mb-2",children:s.displayName}),e.jsx("input",{id:"displayName",type:"text",value:j,onChange:r=>S(r.target.value),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md focus:border-blue-500 focus:outline-none"})]}),e.jsx("button",{onClick:R,disabled:h,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 rounded-md transition-colors",children:s.updateProfile})]})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"보안"}),O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium mb-2",children:s.newPassword}),e.jsx("input",{id:"newPassword",type:"password",value:i,onChange:r=>w(r.target.value),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium mb-2",children:s.confirmPassword}),e.jsx("input",{id:"confirmPassword",type:"password",value:N,onChange:r=>x(r.target.value),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,disabled:h,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 rounded-md transition-colors",children:s.updatePassword}),e.jsx("button",{onClick:()=>{p(!1),P(""),w(""),x(""),t("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors",children:s.cancel})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(q,{className:"h-5 w-5"}),s.changePassword]}),e.jsx("button",{onClick:F,disabled:h,className:"text-blue-400 hover:text-blue-300 text-sm",children:s.resetPassword}),e.jsx("p",{className:"text-sm text-gray-400",children:s.resetPasswordInfo})]})]}),e.jsx("button",{onClick:D,className:"w-full px-4 py-3 bg-red-600 hover:bg-red-700 rounded-md transition-colors font-medium",children:s.signOut})]})})]}):null};export{ee as default};
